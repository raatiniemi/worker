#!/bin/bash
# This script will configure the CI android environment, instead of keeping a
# list of commands within the `.gitlab-ci.yml`.

if [ -z $ANDROID_HOME ]; then
  echo "No ANDROID_HOME have been defined.";
  exit 1;
fi

ANDROID_BUILD_TOOLS="28.0.3";
ANDROID_COMPILE_SDK="28";

function accept_license_and_install {
  yes | "${ANDROID_HOME}/tools/bin/sdkmanager" $1 1>/dev/null;
  if [ $? -ne 0 ]; then
    echo "Failed to install and accept licenses for ${1}";
    exit 1;
  fi
}

echo "Installing Android API and build tools";
accept_license_and_install "build-tools;${ANDROID_BUILD_TOOLS}";
accept_license_and_install "platforms;android-${ANDROID_COMPILE_SDK}";
